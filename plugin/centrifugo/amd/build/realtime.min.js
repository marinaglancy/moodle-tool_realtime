define("realtimeplugin_centrifugo/realtime",["exports","core/pubsub","tool_realtime/events","core/ajax","tool_realtime/api","core/config","./centrifuge-lazy"],(function(_exports,PubSub,RealTimeEvents,Ajax,api,config,_centrifugeLazy){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Real time events using Centrifugo
   *
   * @module     realtimeplugin_centrifugo/realtime
   * @copyright  2025 Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */let params,centrifuge;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(initParams){params=initParams,centrifuge=new _centrifugeLazy.Centrifuge(params.host,{token:params.token,getToken:getToken}),params.userpc&&api.setImplementation({sendToServer:sendToServer})},_exports.subscribe=function(hash,properties){centrifuge.on("disconnected",(function(){PubSub.publish(RealTimeEvents.CONNECTION_LOST)}));const sub=centrifuge.newSubscription(hash);sub.on("publication",(async ctx=>{const payload=ctx.data.payload;var dataToSend={...properties,payload:payload};PubSub.publish(RealTimeEvents.EVENT,dataToSend)})),sub.subscribe(),centrifuge.connect()},PubSub=_interopRequireWildcard(PubSub),RealTimeEvents=_interopRequireWildcard(RealTimeEvents),Ajax=_interopRequireWildcard(Ajax),api=_interopRequireWildcard(api),config=_interopRequireWildcard(config);const sendToServer=(component,payload)=>centrifuge.rpc("user.event",{component:component,sesskey:config.sesskey,payload:payload}).then((response=>response.data));const getToken=async()=>{try{const response=await Ajax.call([{methodname:"realtimeplugin_centrifugo_get_token",args:{}}])[0];params.token=null==response?void 0:response.token}catch(error){params.token=null}if(!params.token)throw new _centrifugeLazy.UnauthorizedError;return params.token}}));

//# sourceMappingURL=realtime.min.js.map