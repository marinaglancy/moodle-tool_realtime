define ("realtimeplugin_phppoll/realtime",["core/pubsub","tool_realtime/events","tool_realtime/api"],function(a,b,c){var d,e=[],f=[],g,h=new XMLHttpRequest,j,k=function(){var c=new Date,d=c.getTime();f.push(d);f=f.slice(-10);if(10<=f.length&&5e3>d-f[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},l=function(){if(!k()){return}h.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){try{j=JSON.parse(this.responseText)}catch(a){setTimeout(l,d.timeout);return}if(!j.success||1!==j.success){return}var c=j.events;for(var e in c){a.publish(b.EVENT,c[e]);d.fromid=c[e].id}setTimeout(l,d.timeout)}else{setTimeout(l,d.timeout)}}};var c=g+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid);if(0>=e.length){return}for(var f="",m="",n="",o="",p="",q=0;q<e.length;q++){if(q==e.length-1){f+=e[q].context;m+=e[q].component;n+=e[q].area;o+=e[q].itemid;p+=e[q].fromtimestamp}else{f+=e[q].context+"-";m+=e[q].component+"-";n+=e[q].area+"-";o+=e[q].itemid+"-";p+=e[q].fromtimestamp+"-"}}var r="&channel="+f+":"+m+":"+n+":"+o+":"+p;c+=r;h.open("GET",c,!0);h.send()},m={init:function init(a,b,e,f){if(!(d&&d.userid)){d={userid:a,token:b,timeout:f}}g=e;c.setImplementation(m)},subscribe:function subscribe(a,b,c,f,g,h){d.fromid=g;var i={context:a,component:b,area:c,itemid:f,fromtimestamp:h};if(i){e.push(i)}console.log(e);setTimeout(l,d.timeout)}};return m});
//# sourceMappingURL=realtime.min.js.map
