define("realtimeplugin_phppoll/realtime",["exports","core/pubsub","tool_realtime/events"],(function(_exports,PubSub,RealTimeEvents){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var params;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(userId,token,pollURLParam,timeout){params&&params.userid||(params={userid:userId,token:token,timeout:timeout});pollURL=pollURLParam},_exports.subscribe=function(hash,properties,fromId){params.fromid=fromId,channels.push(hash),setTimeout(poll,params.timeout)},PubSub=_interopRequireWildcard(PubSub),RealTimeEvents=_interopRequireWildcard(RealTimeEvents);var pollURL,channels=[],requestscounter=[],ajax=new XMLHttpRequest;function poll(){if(curTime=(new Date).getTime(),requestscounter.push(curTime),(requestscounter=requestscounter.slice(-10)).length>=10&&curTime-requestscounter[0]<5e3&&(PubSub.publish(RealTimeEvents.CONNECTION_LOST),1))return;var curTime;if(ajax.onreadystatechange=function(){if(4===this.readyState&&200===this.status)if(200===this.status){let json;try{json=JSON.parse(this.responseText)}catch{return void setTimeout(poll,params.timeout)}if(!json.success||1!==json.success)return void PubSub.publish(RealTimeEvents.CONNECTION_LOST);var events=json.events;for(var i in events)PubSub.publish(RealTimeEvents.EVENT,events[i]),params.fromid=events[i].id;setTimeout(poll,params.timeout)}else setTimeout(poll,params.timeout)},channels.length<=0)return;let query="userid="+encodeURIComponent(params.userid)+"&token="+encodeURIComponent(params.token)+"&fromid="+encodeURIComponent(params.fromid);for(let i=0;i<channels.length;i++)query+="&channels[".concat(i,"]=")+encodeURIComponent(channels[i]);ajax.open("POST",pollURL,!0),ajax.setRequestHeader("Content-type","application/x-www-form-urlencoded"),ajax.send(query)}}));

//# sourceMappingURL=realtime.min.js.map